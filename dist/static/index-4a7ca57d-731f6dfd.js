import{r as l,j as o,aC as re,e as U,b3 as oe,aD as ie,d2 as ae,a2 as H,a4 as ce,a8 as ue,aN as le,f as v,W as de,d3 as me,af as fe,d4 as pe,d5 as he,d6 as ye,aR as ge,bi as Te,a9 as K,F as O,ax as $,S as Ie,bO as Le,i as _,B as x,az as be,Q as Se,m as Re,d7 as Pe,d as N,X as ve,u as Ce,a1 as _e,bq as w,d8 as Ee,d9 as je,da as xe,cN as De,b9 as k,I as Fe,db as Oe,cj as we,ck as Ae,bc as $e,dc as Ne,dd as ke,bQ as M,bS as Me,cK as qe,bJ as Be,bd as We,br as Ue,de as He,df as Ke,cS as Ve,bK as Ye}from"./sanity-2e52752e.js";import{useDeskTool as ze,useDeskToolSetting as q,Delay as Ge}from"./index-def00177-bd2b054e.js";import{P as Xe}from"./PaneItem-61ee1040-8994dfdb.js";import"./json-inspector-7bef3cdb.js";import"./hey-listen.es-6595251d.js";const B=100,A=2e3,V={by:[{field:"_updatedAt",direction:"desc"}]},Qe={};function Je(e,s){return e._id?K(e._id):"item-".concat(s)}function Ze(e){return xe(e).map(s=>({...s.draft||s.published,hasPublished:!!s.published,hasDraft:!!s.draft}))}const et=/\b_type\s*==\s*(['"].*?['"]|\$.*?(?:\s|$))|\B(['"].*?['"]|\$.*?(?:\s|$))\s*==\s*_type\b/;function tt(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e.match(et);if(!n)return null;const t=(n[1]||n[2]).trim().replace(/^["']|["']$/g,"");if(t[0]==="$"){const a=t.slice(1),c=s[a];return typeof c=="string"?c:null}return t}function nt(e){return/^_type\s*==\s*['"$]\w+['"]?\s*$/.test(e.trim())}function st(e){return e.map(s=>[rt(s),(s.direction||"").toLowerCase()].map(n=>n.trim()).filter(Boolean).join(" ")).join(",")}function rt(e){return e.mapWith?"".concat(e.mapWith,"(").concat(e.field,")"):e.field}function ot(e,s){const n=e.by.map(t=>{if(t.mapWith)return t;const a=it(s,t.field);return a?ct(a,"datetime")?{...t,mapWith:"dateTime"}:a.jsonType==="string"?{...t,mapWith:"lower"}:t:t});return n.every((t,a)=>t===e.by[a])?e:{...e,by:n}}function it(e,s){const n=fe(s);let t=e;for(const a of n){if(!t)return;if(typeof a=="string"){t=at(t,a);continue}if(!(pe(a)||he(a))||t.jsonType!=="array")return;const[r,i]=t.of||[];if(i||!r)return;if(!ye(r)){t=r;continue}const[p,h]=r.to||[];if(h||!p)return;t=p}return t}function at(e,s){if(!("fields"in e))return;const n=e.fields.find(t=>t.name===s);return n?n.type:void 0}function ct(e,s){let n=e.type;for(;n;){if(n.name===s||!n.type&&n.jsonType===s)return!0;n=n.type}return!1}function ut(e){const{childItemId:s,error:n,filterIsSimpleTypeContraint:t,fullList:a,isActive:c,isLoading:r,items:i,layout:p,onListChange:h,onRetry:u,showIcons:y}=e,S=H(),{collapsed:b}=ge(),{collapsed:L,index:g}=Te(),[R,P]=l.useState(!1);l.useEffect(()=>{if(L)return;const d=setTimeout(()=>{P(!0)},0);return()=>{clearTimeout(d)}},[L]);const T=l.useCallback(d=>{const I=K(d._id),m=s===I;return o(Xe,{icon:y===!1?!1:void 0,id:I,pressed:!c&&m,selected:c&&m,layout:p,schemaType:S.get(d._type),value:d})},[s,c,p,S,y]),f=l.useMemo(()=>{if(!R)return null;if(n)return o(O,{align:"center",direction:"column",height:"fill",justify:"center",children:o($,{width:1,children:v(Ie,{paddingX:4,paddingY:5,space:4,children:[o(Le,{as:"h3",children:"Could not fetch list items"}),v(_,{as:"p",children:["Error: ",o("code",{children:n.message})]}),u&&o(x,{children:o(U,{icon:be,onClick:u,text:"Retry",tone:"primary"})})]})})});if(i===null)return o(O,{align:"center",direction:"column",height:"fill",justify:"center",children:o(Ge,{ms:300,children:v(Se,{children:[o(Re,{muted:!0}),o(x,{marginTop:3,children:o(_,{align:"center",muted:!0,size:1,children:"Loading documents…"})})]})})});if(!r&&i.length===0)return o(O,{align:"center",direction:"column",height:"fill",justify:"center",children:o($,{width:1,children:o(x,{paddingX:4,paddingY:5,children:o(_,{align:"center",muted:!0,size:2,children:t?"No documents of this type":"No matching documents"})})})});const d=a&&i.length===A;return v(x,{padding:2,children:[i.length>0&&o(Pe,{gap:1,getItemKey:Je,items:i,renderItem:T,onChange:h},"".concat(g,"-").concat(L)),r&&o(N,{borderTop:!0,marginTop:1,paddingX:3,paddingY:4,children:o(_,{align:"center",muted:!0,size:1,children:"Loading…"})}),d&&o(N,{marginTop:1,paddingX:3,paddingY:4,radius:2,tone:"transparent",children:v(_,{align:"center",muted:!0,size:1,children:["Displaying a maximum of ",A," documents"]})})]})},[n,t,a,h,r,i,u,T,R,L,g]);return o(ve,{overflow:b?void 0:"auto",children:f})}const Y=l.memo(e=>{let{index:s,initialValueTemplates:n=[],menuItems:t=[],menuItemGroups:a=[],setLayout:c,setSortOrder:r,title:i}=e;const{features:p}=ze(),h=l.useMemo(()=>({setLayout:u=>{let{layout:y}=u;c(y)},setSortOrder:u=>{r(u)}}),[c,r]);return o(re,{backButton:p.backButton&&s>0&&o(U,{as:oe,"data-as":"a",icon:ie,mode:"bleed"}),title:i,actions:o(ae,{initialValueTemplateItems:n,actionHandlers:h,menuItemGroups:a,menuItems:t})})});Y.displayName="DocumentListPaneHeader";const lt={result:null,error:!1},dt=e=>({result:{documents:e},loading:!1,error:!1}),mt=e=>({result:null,loading:!1,error:e}),ft=function(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new De,t=n.next.bind(n);return e.pipe(k(r=>({client:r.client,query:r.query,params:r.params})),Fe(Oe),we(1),Ae()).pipe($e(r=>{const i=Ne(r.client,r.query,r.params,s).pipe(k(dt),ke());return M(w({loading:!0}).pipe(Me(400),qe(i)),i)})).pipe(Be(lt),We((r,i)=>Ue(w(mt(r)),M(He(window,"online"),n).pipe(Ke(1),Ve(i)))),Ye((r,i)=>({...r,...i,onRetry:t})))};function pt(e){var s;const{apiVersion:n,filter:t,params:a,sortOrder:c}=e,r=Ce(_e),[i,p]=l.useState(!1),h=l.useRef(i),[u,y]=l.useState(null),S=(u==null?void 0:u.error)||null,b=(u==null?void 0:u.loading)||u===null,L=u==null?void 0:u.onRetry,g=(s=u==null?void 0:u.result)==null?void 0:s.documents,R=l.useMemo(()=>g?Ze(g):null,[g]),P=l.useMemo(()=>{const f=c==null?void 0:c.extendedProjection,d=["_id","_type"],I=d.join(","),m=(c==null?void 0:c.by)||[],C=i?A:B,E=m.length>0?m:V.by,j=st(E);if(f){const D=d.concat(f).join(",");return["*[".concat(t,"] {").concat(D,"}"),"order(".concat(j,") [0...").concat(C,"]"),"{".concat(I,"}")].join("|")}return"*[".concat(t,"]|order(").concat(j,")[0...").concat(C,"]{").concat(I,"}")},[t,i,c]),T=l.useCallback(f=>{let{toIndex:d}=f;b||h.current||d>=B/2&&(p(!0),h.current=!0)},[b]);return l.useEffect(()=>{const f=i?m=>Boolean(m.result):()=>!0;y(m=>m?{...m,loading:!0}:null);const I=ft(w({client:r,query:P,params:a}),{apiVersion:n,tag:"desk.document-list"}).pipe(Ee(f)).subscribe(y);return()=>I.unsubscribe()},[n,r,i,P,a]),l.useEffect(()=>{y(null),p(!1),h.current=!1},[t,a,c,n]),{error:S,fullList:i,handleListChange:T,isLoading:b,items:R,onRetry:L}}const W=[];function ht(e){const s=l.useRef(e);return je(s.current,e)||(s.current=e),s.current}const bt=l.memo(function(s){const{childItemId:n,index:t,isActive:a,isSelected:c,pane:r,paneKey:i}=s,p=H(),{name:h}=ce(),{defaultLayout:u="default",displayOptions:y,initialValueTemplates:S=W,menuItems:b,menuItemGroups:L,options:g,title:R}=r,{apiVersion:P,defaultOrdering:T=W,filter:f}=g,d=ht(g.params||Qe),I=r.source,m=l.useMemo(()=>tt(f,d),[f,d]),C=(y==null?void 0:y.showIcons)!==!1,[E,j]=q(m,"layout",u),D=l.useMemo(()=>(T==null?void 0:T.length)>0?{by:T}:V,[T]),[F,z]=q(m,"sortOrder",D),G=m&&F?ot(F,p.get(m)):F,X=ue(G),Q=nt(f),{error:J,fullList:Z,handleListChange:ee,isLoading:te,items:ne,onRetry:se}=pt({filter:f,params:d,sortOrder:X,apiVersion:P});return o(le,{name:I||h,children:v(de,{currentMaxWidth:350,id:i,maxWidth:640,minWidth:320,selected:c,children:[me,o(Y,{index:t,initialValueTemplates:S,menuItems:b,menuItemGroups:L,setLayout:j,setSortOrder:z,title:R}),o(ut,{childItemId:n,error:J,filterIsSimpleTypeContraint:Q,fullList:Z,isActive:a,isLoading:te,items:ne,layout:E,onListChange:ee,onRetry:se,showIcons:C})]})})});export{bt as default};
